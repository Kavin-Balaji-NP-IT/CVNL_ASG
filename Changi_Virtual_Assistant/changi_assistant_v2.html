<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Changi Virtual Assist (Demo)</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;background:#f5f7fb;color:#1a2b3c;margin:0}
    header{padding:16px;background:#fff;border-bottom:1px solid #e6eef5}
    .container{max-width:900px;margin:24px auto;padding:0 16px}
    .status-badge{float:right;background:#ffb84d;color:#fff;padding:6px 12px;border-radius:16px;font-weight:600}
    .chat{background:#fff;border-radius:12px;padding:16px;box-shadow:0 6px 18px rgba(26,43,60,0.06);min-height:420px;display:flex;flex-direction:column}
    #messages{flex:1;overflow:auto;padding:12px;border-radius:8px}
    .message{margin:8px 0;padding:10px;border-radius:10px;max-width:75%}
    .message-user{background:#0052cc;color:#fff;margin-left:auto}
    .message-assistant{background:#eef6ff;color:#0b2b54;margin-right:auto}
    .input-area{display:flex;gap:8px;margin-top:12px}
    textarea{flex:1;padding:10px;border-radius:8px;border:1px solid #e1e8ed;resize:none}
    button{background:#0052cc;color:#fff;padding:10px 16px;border-radius:8px;border:none;cursor:pointer}
    .debug{background:#fff7e6;padding:8px;border:1px dashed #ffd59e;margin-top:12px;border-radius:8px}
  </style>
</head>
<body>
  <header>
    <div class="container">
      <h1 style="display:inline-block">Changi Virtual Assist</h1>
      <div class="status-badge" id="statusBadge">Demo Mode</div>
    </div>
  </header>

  <div class="container">
    <div class="chat">
      <div id="messages">
        <div class="message message-assistant">ðŸ‘‹ Welcome! I'm powered by a trained RNN model. Ask me about flights, gates, transport, or airport services.</div>
      </div>

      <div class="input-area">
        <textarea id="userInput" rows="1" placeholder="Ask about flights, gates, luggage or transport..."></textarea>
        <button id="sendButton">Send</button>
      </div>
      <div class="debug" id="debugBox">Debug: Demo mode active</div>
    </div>
  </div>

  <script>
    const API_URL = 'http://localhost:5000/api/predict';

    function addMessage(text, isUser=false) {
      const m = document.createElement('div');
      m.className = 'message ' + (isUser ? 'message-user' : 'message-assistant');
      m.textContent = text;
      document.getElementById('messages').appendChild(m);
      document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
    }

    async function sendMessage(text) {
      try {
        const response = await fetch(API_URL, {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({query: text})
        });
        
        if (response.ok) {
          const data = await response.json();
          return data.response || 'Sorry, I could not process that request.';
        } else {
          return 'Sorry, there was an error processing your request.';
        }
      } catch (error) {
        console.error('Error:', error);
        return 'Sorry, I could not connect to the server.';
      }
    }

    document.getElementById('sendButton').addEventListener('click', async () => {
      const input = document.getElementById('userInput');
      const txt = input.value.trim(); 
      if (!txt) return;
      
      addMessage(txt, true);
      input.value = '';
      
      const response = await sendMessage(txt);
      addMessage(response);
    });

    document.getElementById('userInput').addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        document.getElementById('sendButton').click();
      }
    });
  </script>
</body>
</html>